fn primes[T](n: int, t: T, body: fn(int, T, fn(T)), ret: fn(T)) {
    if n < 2 {
        ret(t)
    }

    body(2, t, |t| {
        fn loop(i: int, t: T) {
            fn inner_loop(j: int) {
                if j < i {
                    if i % j == 0 {
                        loop(i + 1, t)
                    } else {
                        inner_loop(j + 1)
                    }
                }
                body(i, t, |t| loop(i+1, t))
            }
            if (i < n) {
                inner_loop(2)
            } else {
                ret(t)
            }
        }
        loop(3, t)
    })
}

fn main(main_ret: fn(int)) {
    let x:int = primes(50, 0, 
           |p, result, next| next(result + p));
    
    primes(100, (0, 42),
        |p, result, next| {
            next(result)
        },
        |result : (int, int)| {
            main_ret(result(0))
        }
    )
}
